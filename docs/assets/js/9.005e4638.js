(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{180:function(t,s,a){t.exports=a.p+"assets/img/linux-polkit-message-box.8df20cfc.png"},241:function(t,s,a){"use strict";a.r(s);var e=[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"linux-授权弹窗-polkit"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux-授权弹窗-polkit","aria-hidden":"true"}},[this._v("#")]),this._v(" "),s("code",[this._v("Linux")]),this._v(" 授权弹窗 "),s("code",[this._v("polkit")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在开发Linux桌面软件的时候，我们有时候需要用其他用户的身份执行一些操作，通常是 "),s("code",[this._v("root")]),this._v(" 用户。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"方法一：sudo命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方法一：sudo命令","aria-hidden":"true"}},[this._v("#")]),this._v(" 方法一：sudo命令")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("终端执行 "),s("code",[this._v('echo "passwd" | sudo -S gedit')]),this._v(" "),s("code",[this._v("sudo")]),this._v(" 命令的 "),s("code",[this._v("-S")]),this._v(" 选项是从标准输出流读取密码，使用这种方法没有交互，可以直接提升权限。如果将这条命令写到脚本里，密码需要明文，是不安全的做法，不过简单有效。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"方法二：polkit"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方法二：polkit","aria-hidden":"true"}},[this._v("#")]),this._v(" 方法二：polkit")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如图所示：\n"),s("img",{attrs:{src:a(180),alt:"深度截图_deepin-graphics-driver-manager_20180905202415.png"}}),this._v("\n这种弹窗是经常见到的吧，这个是怎么调用出来的呢？")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("常见的 "),a("code",[t._v("Linux")]),t._v(" 发行版都有 "),a("code",[t._v("polkit")]),t._v(" 模块，"),a("code",[t._v("Deepin")]),t._v(" 也开发了一套，"),a("code",[t._v("dde-polkit-agent")]),t._v(" 号称是遵守 "),a("code",[t._v("freedesktop")]),t._v(" 规范的。\n我们只要配置好规则文件然后在终端执行：\n"),a("code",[t._v("pkexec <可执行文件>")]),t._v("\n就可以看到这个授权窗口了")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_1-配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置文件","aria-hidden":"true"}},[this._v("#")]),this._v(" 1. 配置文件")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("以 "),s("code",[this._v("Deepin")]),this._v(" 的 "),s("code",[this._v("/usr/share/polkit-1/actions/com.deepin.pkexec.dde-file-manager.policy")]),this._v("文件为例")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token prolog"}},[t._v('<?xml version="1.0" encoding="UTF-8"?>')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token doctype"}},[t._v('<!DOCTYPE policyconfig PUBLIC\n "-//freedesktop//DTD PolicyKit Policy Configuration 1.0//EN"\n "http://www.freedesktop.org/standards/PolicyKit/1/policyconfig.dtd">')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("policyconfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("vendor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Deepin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("vendor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("vendor_url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("https://www.deepin.com"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("vendor_url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 权限ID，这个必须唯一 --\x3e")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("action")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("com.deepin.pkexec.dde-file-manager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 图标 这个我不知道存在哪里，再研究研究--\x3e")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("icon_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("folder"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("icon_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 弹窗提示 --\x3e")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Authentication is required to run the Deepin File Manager"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("defaults")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("allow_any")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("no"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("allow_any")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("allow_inactive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("no"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("allow_inactive")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("allow_active")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("auth_admin_keep"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("allow_active")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 这个defaults节点下的所有子节点可以有这些值no,yes,auth_self,auth_admin,auth_self_keep,auth_admin_keep　--\x3e")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("defaults")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 语言为简体中文时的弹窗提示 --\x3e")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("message")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xml:")]),t._v("lang")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("zh_CN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("查看文件夹需要输入密码"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 权限提升的可执行文件，需是二进制文件 --\x3e")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("annotate")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.freedesktop.policykit.exec.path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("/usr/bin/dde-file-manager"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("annotate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 这行听说是是否允许GUI，但是测试的时候好像不起作用 --\x3e")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("annotate")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.freedesktop.policykit.exec.allow_gui"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("true"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("annotate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("action")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("policyconfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("只需要根据你的需要创建一份这样的文件（以 "),a("code",[t._v("policy")]),t._v(" 为扩展名），然后保存到 "),a("code",[t._v("/usr/share/polkit-1/action")]),t._v(" 这个目录下。\n可以执行 "),a("code",[t._v("pkaction")]),t._v(" 查看现有的 "),a("code",[t._v("policy")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-调出弹窗"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-调出弹窗","aria-hidden":"true"}},[this._v("#")]),this._v(" 2. 调出弹窗")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在终端执行\n"),s("code",[this._v("pkexec [二进制可执行文件]")]),this._v("\n当然，根据上述配置文件，应该是\n"),s("code",[this._v("pkexec /usr/bin/dde-file-manager")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"tips"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tips","aria-hidden":"true"}},[this._v("#")]),this._v(" Tips")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("如果要给脚本提权怎么办呢，我们就需要借助一个 "),a("code",[t._v("bash")]),t._v(" 解释器——它是一个二进制的可执行文件，我们选用 "),a("code",[t._v("/bin/bash")]),t._v(" ，先给 "),a("code",[t._v("bash")]),t._v(" 创建一个 "),a("code",[t._v("policy")]),t._v(" 文件[ "),a("code",[t._v("deepin")]),t._v(" 不用创建，已经有了]，然后执行 "),a("code",[t._v("pkexec /bin/bash -x <脚本>")]),t._v("\n将脚本作为bash的参数【在deepin下执行有个副作用，因为深度显卡驱动管理器的脚本提权用到了bash，所以会显示驱动管理器的图标和提示】")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"参考链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考链接","aria-hidden":"true"}},[this._v("#")]),this._v(" 参考链接")])}],n=a(0),r=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.freedesktop.org/software/polkit/docs/latest/polkit.8.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("freedestop的polkit介绍"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://www.freedesktop.org/software/polkit/docs/latest/pkexec.1.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("freedesktop的pkexec介绍"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://segmentfault.com/a/1190000008063961",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://segmentfault.com/a/1190000008063961"),a("OutboundLink")],1)]),t._v(" "),a("comment-comment")],1)},e,!1,null,null,null);s.default=r.exports}}]);