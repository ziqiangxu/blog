"use strict";(self.webpackChunkziqiangxu_github_io=self.webpackChunkziqiangxu_github_io||[]).push([[595],{6891:(n,a,s)=>{s.r(a),s.d(a,{data:()=>e});const e={key:"v-01d6b48d",path:"/accumulation/Linux%E6%8E%88%E6%9D%83%E5%BC%B9%E7%AA%97%EF%BC%9Apolkit.html",title:"Linux 授权弹窗 polkit",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"方法一：sudo命令",slug:"方法一-sudo命令",children:[]},{level:2,title:"方法二：polkit",slug:"方法二-polkit",children:[{level:3,title:"1. 配置文件",slug:"_1-配置文件",children:[]},{level:3,title:"2. 调出弹窗",slug:"_2-调出弹窗",children:[]},{level:3,title:"Tips",slug:"tips",children:[]}]},{level:2,title:"参考链接",slug:"参考链接",children:[]}],filePathRelative:"accumulation/Linux授权弹窗：polkit.md",git:{updatedTime:1595072993e3}}},5699:(n,a,s)=>{s.r(a),s.d(a,{default:()=>C});var e=s(6252);const t=s.p+"assets/img/linux-polkit-message-box.a5fa9e15.png",l=(0,e.Wm)("h1",{id:"linux-授权弹窗-polkit",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#linux-授权弹窗-polkit","aria-hidden":"true"},"#"),(0,e.Uk)(),(0,e.Wm)("code",null,"Linux"),(0,e.Uk)(" 授权弹窗 "),(0,e.Wm)("code",null,"polkit")],-1),o=(0,e.Wm)("p",null,[(0,e.Uk)("在开发Linux桌面软件的时候，我们有时候需要用其他用户的身份执行一些操作，通常是 "),(0,e.Wm)("code",null,"root"),(0,e.Uk)(" 用户。")],-1),c=(0,e.Wm)("h2",{id:"方法一-sudo命令",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#方法一-sudo命令","aria-hidden":"true"},"#"),(0,e.Uk)(" 方法一：sudo命令")],-1),m=(0,e.Wm)("p",null,[(0,e.Uk)("终端执行 "),(0,e.Wm)("code",null,'echo "passwd" | sudo -S gedit'),(0,e.Wm)("code",null,"sudo"),(0,e.Uk)(" 命令的 "),(0,e.Wm)("code",null,"-S"),(0,e.Uk)(" 选项是从标准输出流读取密码，使用这种方法没有交互，可以直接提升权限。如果将这条命令写到脚本里，密码需要明文，是不安全的做法，不过简单有效。")],-1),p=(0,e.Wm)("h2",{id:"方法二-polkit",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#方法二-polkit","aria-hidden":"true"},"#"),(0,e.Uk)(" 方法二：polkit")],-1),k=(0,e.Wm)("p",null,[(0,e.Uk)("如图所示： "),(0,e.Wm)("img",{src:t,alt:"深度截图_deepin-graphics-driver-manager_20180905202415.png"}),(0,e.Uk)(" 这种弹窗是经常见到的吧，这个是怎么调用出来的呢？")],-1),u=(0,e.Wm)("p",null,[(0,e.Uk)("常见的 "),(0,e.Wm)("code",null,"Linux"),(0,e.Uk)(" 发行版都有 "),(0,e.Wm)("code",null,"polkit"),(0,e.Uk)(" 模块，"),(0,e.Wm)("code",null,"Deepin"),(0,e.Uk)(" 也开发了一套，"),(0,e.Wm)("code",null,"dde-polkit-agent"),(0,e.Uk)(" 号称是遵守 "),(0,e.Wm)("code",null,"freedesktop"),(0,e.Uk)(" 规范的。 我们只要配置好规则文件然后在终端执行： "),(0,e.Wm)("code",null,"pkexec <可执行文件>"),(0,e.Uk)(" 就可以看到这个授权窗口了")],-1),i=(0,e.Wm)("h3",{id:"_1-配置文件",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_1-配置文件","aria-hidden":"true"},"#"),(0,e.Uk)(" 1. 配置文件")],-1),W=(0,e.Wm)("p",null,[(0,e.Uk)("以 "),(0,e.Wm)("code",null,"Deepin"),(0,e.Uk)(" 的 "),(0,e.Wm)("code",null,"/usr/share/polkit-1/actions/com.deepin.pkexec.dde-file-manager.policy"),(0,e.Uk)("文件为例")],-1),r=(0,e.Wm)("div",{class:"language-xml ext-xml line-numbers-mode"},[(0,e.Wm)("pre",{class:"language-xml"},[(0,e.Wm)("code",null,[(0,e.Wm)("span",{class:"token prolog"},'<?xml version="1.0" encoding="UTF-8"?>'),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token doctype"},[(0,e.Wm)("span",{class:"token punctuation"},"<!"),(0,e.Wm)("span",{class:"token doctype-tag"},"DOCTYPE"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token name"},"policyconfig"),(0,e.Uk)(),(0,e.Wm)("span",{class:"token name"},"PUBLIC"),(0,e.Uk)("\n "),(0,e.Wm)("span",{class:"token string"},'"-//freedesktop//DTD PolicyKit Policy Configuration 1.0//EN"'),(0,e.Uk)("\n "),(0,e.Wm)("span",{class:"token string"},'"http://www.freedesktop.org/standards/PolicyKit/1/policyconfig.dtd"'),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("policyconfig")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("vendor")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("Deepin"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("vendor")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("vendor_url")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("https://www.deepin.com"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("vendor_url")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token comment"},"\x3c!-- 权限ID，这个必须唯一 --\x3e"),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("action")]),(0,e.Uk)(),(0,e.Wm)("span",{class:"token attr-name"},"id"),(0,e.Wm)("span",{class:"token attr-value"},[(0,e.Wm)("span",{class:"token punctuation attr-equals"},"="),(0,e.Wm)("span",{class:"token punctuation"},'"'),(0,e.Uk)("com.deepin.pkexec.dde-file-manager"),(0,e.Wm)("span",{class:"token punctuation"},'"')]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"\x3c!-- 图标 这个我不知道存在哪里，再研究研究--\x3e"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("icon_name")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("folder"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("icon_name")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"\x3c!-- 弹窗提示 --\x3e"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("message")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("Authentication is required to run the Deepin File Manager"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("message")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("defaults")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("allow_any")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("no"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("allow_any")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("allow_inactive")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("no"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("allow_inactive")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("allow_active")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("auth_admin_keep"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("allow_active")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n      "),(0,e.Wm)("span",{class:"token comment"},"\x3c!-- 这个defaults节点下的所有子节点可以有这些值no,yes,auth_self,auth_admin,auth_self_keep,auth_admin_keep　--\x3e"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("defaults")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"\x3c!-- 语言为简体中文时的弹窗提示 --\x3e"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("message")]),(0,e.Uk)(),(0,e.Wm)("span",{class:"token attr-name"},[(0,e.Wm)("span",{class:"token namespace"},"xml:"),(0,e.Uk)("lang")]),(0,e.Wm)("span",{class:"token attr-value"},[(0,e.Wm)("span",{class:"token punctuation attr-equals"},"="),(0,e.Wm)("span",{class:"token punctuation"},'"'),(0,e.Uk)("zh_CN"),(0,e.Wm)("span",{class:"token punctuation"},'"')]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("查看文件夹需要输入密码"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("message")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"\x3c!-- 权限提升的可执行文件，需是二进制文件 --\x3e"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("annotate")]),(0,e.Uk)(),(0,e.Wm)("span",{class:"token attr-name"},"key"),(0,e.Wm)("span",{class:"token attr-value"},[(0,e.Wm)("span",{class:"token punctuation attr-equals"},"="),(0,e.Wm)("span",{class:"token punctuation"},'"'),(0,e.Uk)("org.freedesktop.policykit.exec.path"),(0,e.Wm)("span",{class:"token punctuation"},'"')]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("/usr/bin/dde-file-manager"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("annotate")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token comment"},"\x3c!-- 这行听说是是否允许GUI，但是测试的时候好像不起作用 --\x3e"),(0,e.Uk)("\n    "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"<"),(0,e.Uk)("annotate")]),(0,e.Uk)(),(0,e.Wm)("span",{class:"token attr-name"},"key"),(0,e.Wm)("span",{class:"token attr-value"},[(0,e.Wm)("span",{class:"token punctuation attr-equals"},"="),(0,e.Wm)("span",{class:"token punctuation"},'"'),(0,e.Uk)("org.freedesktop.policykit.exec.allow_gui"),(0,e.Wm)("span",{class:"token punctuation"},'"')]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("true"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("annotate")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n  "),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("action")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n"),(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token tag"},[(0,e.Wm)("span",{class:"token punctuation"},"</"),(0,e.Uk)("policyconfig")]),(0,e.Wm)("span",{class:"token punctuation"},">")]),(0,e.Uk)("\n")])]),(0,e.Wm)("div",{class:"line-numbers"},[(0,e.Wm)("span",{class:"line-number"},"1"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"2"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"3"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"4"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"5"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"6"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"7"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"8"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"9"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"10"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"11"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"12"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"13"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"14"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"15"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"16"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"17"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"18"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"19"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"20"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"21"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"22"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"23"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"24"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"25"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"26"),(0,e.Wm)("br"),(0,e.Wm)("span",{class:"line-number"},"27"),(0,e.Wm)("br")])],-1),d=(0,e.Wm)("p",null,[(0,e.Uk)("只需要根据你的需要创建一份这样的文件（以 "),(0,e.Wm)("code",null,"policy"),(0,e.Uk)(" 为扩展名），然后保存到 "),(0,e.Wm)("code",null,"/usr/share/polkit-1/action"),(0,e.Uk)(" 这个目录下。 可以执行 "),(0,e.Wm)("code",null,"pkaction"),(0,e.Uk)(" 查看现有的 "),(0,e.Wm)("code",null,"policy")],-1),U=(0,e.Wm)("h3",{id:"_2-调出弹窗",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#_2-调出弹窗","aria-hidden":"true"},"#"),(0,e.Uk)(" 2. 调出弹窗")],-1),g=(0,e.Wm)("p",null,[(0,e.Uk)("在终端执行 "),(0,e.Wm)("code",null,"pkexec [二进制可执行文件]"),(0,e.Uk)(" 当然，根据上述配置文件，应该是 "),(0,e.Wm)("code",null,"pkexec /usr/bin/dde-file-manager")],-1),b=(0,e.Wm)("h3",{id:"tips",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#tips","aria-hidden":"true"},"#"),(0,e.Uk)(" Tips")],-1),h=(0,e.Wm)("p",null,[(0,e.Uk)("如果要给脚本提权怎么办呢，我们就需要借助一个 "),(0,e.Wm)("code",null,"bash"),(0,e.Uk)(" 解释器——它是一个二进制的可执行文件，我们选用 "),(0,e.Wm)("code",null,"/bin/bash"),(0,e.Uk)(" ，先给 "),(0,e.Wm)("code",null,"bash"),(0,e.Uk)(" 创建一个 "),(0,e.Wm)("code",null,"policy"),(0,e.Uk)(" 文件[ "),(0,e.Wm)("code",null,"deepin"),(0,e.Uk)(" 不用创建，已经有了]，然后执行 "),(0,e.Wm)("code",null,"pkexec /bin/bash -x <脚本>"),(0,e.Uk)(" 将脚本作为bash的参数【在deepin下执行有个副作用，因为深度显卡驱动管理器的脚本提权用到了bash，所以会显示驱动管理器的图标和提示】")],-1),x=(0,e.Wm)("h2",{id:"参考链接",tabindex:"-1"},[(0,e.Wm)("a",{class:"header-anchor",href:"#参考链接","aria-hidden":"true"},"#"),(0,e.Uk)(" 参考链接")],-1),f={href:"https://www.freedesktop.org/software/polkit/docs/latest/polkit.8.html",target:"_blank",rel:"noopener noreferrer"},_=(0,e.Uk)("freedestop的polkit介绍"),v={href:"https://www.freedesktop.org/software/polkit/docs/latest/pkexec.1.html",target:"_blank",rel:"noopener noreferrer"},w=(0,e.Uk)("freedesktop的pkexec介绍"),y={href:"https://segmentfault.com/a/1190000008063961",target:"_blank",rel:"noopener noreferrer"},D=(0,e.Uk)("https://segmentfault.com/a/1190000008063961"),C={render:function(n,a){const s=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.j4)(e.HY,null,[l,o,c,m,p,k,u,i,W,r,d,U,g,b,h,x,(0,e.Wm)("p",null,[(0,e.Wm)("a",f,[_,(0,e.Wm)(s)]),(0,e.Wm)("a",v,[w,(0,e.Wm)(s)]),(0,e.Wm)("a",y,[D,(0,e.Wm)(s)])])],64)}}}}]);