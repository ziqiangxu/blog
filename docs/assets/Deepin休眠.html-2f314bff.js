import{_ as i,r as o,o as c,c as l,a as e,b as s,d,e as n}from"./app-55a6058c.js";const r="/blog/assets/deepin-hibernate-msg-box-d918a1ef.png",t="/blog/assets/deepin-hibernate-select-swap-file-2e9aed1c.png",p="/blog/assets/deepin-hibernate-is-encrypt-data-e9ca8466.png",u={},h=e("h1",{id:"deepin-如何休眠",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#deepin-如何休眠","aria-hidden":"true"},"#"),s(),e("code",null,"Deepin"),s(" 如何休眠")],-1),b={href:"https://www.deepin.org",target:"_blank",rel:"noopener noreferrer"},v=e("code",null,"Linux",-1),m=e("code",null,"swap",-1),w=n('<h2 id="情况一" tabindex="-1"><a class="header-anchor" href="#情况一" aria-hidden="true">#</a> 情况一</h2><p>如果你的电脑有 <code>swap</code> 分区， <code>deepin</code> 会探测到，关机的时候会有休眠选项了，这个功能终于加到关机菜单里了，给 <code>deepin</code> 点赞。</p><p><s>一般来说，如果你有一个可以正常使用的swap分区，只需要在终端执行</s><s><code>systemctl hibernate</code></s><s>就可以休眠了。</s></p><p><strong>当然，也有例外</strong>, 如果你休眠之后开机发现你的电脑并没有恢复现场，则需要指定一下启动的磁盘（从swap分区启动），操作方法如下：</p><blockquote><p>修改/etc/default/grub这个文件中的相关内容 <code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;resume=/dev/sda3 quiet&quot;</code> 其中 <code>/dev/sda3</code> 改为你的 <code>swap</code> 分区对应的标志即可（推荐使用 <code>gparted</code> 查看） 然后再执行 <code>sudo update-grub</code></p></blockquote><h2 id="情况二" tabindex="-1"><a class="header-anchor" href="#情况二" aria-hidden="true">#</a> 情况二</h2>',6),_={href:"https://wiki.debian.org/Hibernation/Hibernate_Without_Swap_Partition",target:"_blank",rel:"noopener noreferrer"},f=n(`<h3 id="_1-创建一个swap文件" tabindex="-1"><a class="header-anchor" href="#_1-创建一个swap文件" aria-hidden="true">#</a> 1. 创建一个swap文件</h3><div class="language-copy-to-clipboard line-numbers-mode" data-ext="copy-to-clipboard"><pre class="language-copy-to-clipboard"><code>fallocate -l 256m /swap
mkswap /swap
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>“256”是指以MB为单位的大小（其后的&#39;m&#39;）。将其设置为RAM的至少一半大小(这个是debian wiki给定的数据，我建议设置为至少设置为内存相同大小)。“/swap”是交换文件的路径。它可以位于任何分区（例如root或home）。</p><h3 id="_2-进行swap文件相关设置" tabindex="-1"><a class="header-anchor" href="#_2-进行swap文件相关设置" aria-hidden="true">#</a> 2. 进行swap文件相关设置</h3><ul><li><p>挂载swap文件 将此行添加到/etc/fstab文件中： <code>/swap swap swap defaults 0 0</code></p></li><li><p>减少使用swap文件 终端执行 <code>sudo sysctl -w vm.swappiness = 1</code> 并在/etc/sysctl.d中创建一个名为local.conf的文件，为了使vm.swappiness保持不变，文件内容如下:</p></li></ul><div class="language-copy-to-clipboard line-numbers-mode" data-ext="copy-to-clipboard"><pre class="language-copy-to-clipboard"><code>vm.swappiness = 1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,6),g={href:"http://blog.sina.com.cn/s/blog_13cc013b50102wskd.html",target:"_blank",rel:"noopener noreferrer"},k=e("code",null,"swap",-1),x=e("code",null,"swap",-1),y=e("code",null,"swap",-1),q=n('<ul><li>激活swap文件： 终端执行 <code>sudo swapon /swap</code></li></ul><h3 id="_3-安装和配置相关软件" tabindex="-1"><a class="header-anchor" href="#_3-安装和配置相关软件" aria-hidden="true">#</a> 3. 安装和配置相关软件</h3><p>使用uswsusp这个软件，这是linux内核使用swap文件代替swap分区来进行挂起（休眠）的方法，并且还支持压缩和加密等功能。</p><ul><li><p>安装uswsusp： 终端执行 <code>aptitude install uswsusp</code></p></li><li><p>配置uswsusp： 终端执行 <code>sudo dpkg-reconfigure -pmedium uswsusp</code>，然后会出现如下提示框 <img src="'+r+'" alt="深度截图_选择区域_20180605160224.png"> 从这个问题开始全部选择确定，直到出现：</p></li></ul><p><img src="'+t+'" alt="选择swap文件"> 此处选择你要使用的swap文件，注：我这里是/var/swapfile这个文件</p><p><img src="'+p+`" alt="选择是否对休眠写入swap的数据加密"> 根据需要选择就好（需要知晓的是，开启加密功能之后休眠的启动所消耗的时间会增加）。如果选择加密的话，它会提示你设定一个密码</p><ul><li>对uswsusp进行进一步配置</li></ul><p>一般配置文件/etc/uswsusp.conf内容如下所示：</p><div class="language-copy-to-clipboard line-numbers-mode" data-ext="copy-to-clipboard"><pre class="language-copy-to-clipboard"><code>＃/etc/uswsusp.conf（8） -- Configuration file for s2disk / s2both

resume device= /swap

compress = y

early writeout= y

image size= 238941634

RSA key file = /etc/uswsusp.key

shutdown method = platform

resume offset = 8288

# encrypt = y 如果你选择了对数据加密，则会有这一行
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>resume offset = 8288</code> 是交换文件实际存放的地方（应该是硬盘的物理地址）。你可以终端执行 <code>swap-offset /swap</code> 获得这个值。 <code>resume device</code> 必须是分区而不是交换文件。一般这行的值会在上一步完成后变成你的 <code>swap</code> 文件的路径，需要改成你的 <code>swap</code> 文件所在的分区，如 <code>/dev/sda1</code></p><p>编辑 <code>/etc/uswsusp.conf</code> 文件后： 终端执行 <code>sudo update-initramfs -u</code></p><ol><li>默认启动的配置 为了让系统启动时，默认从swap文件加载数据。将 <code>/etc/default/grub</code> 文件中的相关设置进行修改： <code>GRUB_CMDLINE_LINUX_DEFAULT =&quot;resume = /dev/sda1 quiet&quot;</code> 其中 <code>/dev/sda1</code> 是交换文件所在的分区。 终端执行 <code>sudo update-grub</code></li></ol><h2 id="测试休眠" tabindex="-1"><a class="header-anchor" href="#测试休眠" aria-hidden="true">#</a> 测试休眠</h2><p>终端执行：<code>sudo s2disk</code></p><p><strong>注</strong>：配置成功之后，如果再次修改了 <code>uswsusp</code> 的设置需要执行</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> update-initramfs <span class="token parameter variable">-u</span>
<span class="token function">sudo</span> <span class="token function">update-grub</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="附录" tabindex="-1"><a class="header-anchor" href="#附录" aria-hidden="true">#</a> 附录</h2><p>如果你的磁盘分区结构变了，比如 <code>sda3</code> 变成了 <code>sda4</code>，按照上面步骤再来一遍就好啦（因为需要更新 <code>grub</code> 和 <code>uswsusp.conf</code>）。</p>`,18);function D(L,N){const a=o("ExternalLinkIcon");return c(),l("div",null,[h,e("p",null,[e("a",b,[s("deepin官网"),d(a)]),s(" 休眠这个功能还是很酷很实用的，对于 "),v,s(" 系统，休眠一般就是把内存中的数据写入硬盘（"),m,s("文件），然后关机。在下一次开机的时候将数据重新载入内存，让你快速回到上一次的工作状态，这在你开启了大量的程序但需要暂停工作的时候尤其好用。")]),w,e("p",null,[s("如果你没办法从硬盘划分一个swap分区，你可以通过使用swap文件来进行休眠。 "),e("a",_,[s("本教程参考了Debian的wiki"),d(a)]),s(" 大体思路：创建swap文件-->配置swap文件-->安装uswsusp-->配置uswsusp")]),f,e("blockquote",null,[e("p",null,[e("a",g,[s("vm.swappiness扩展知识"),d(a)]),s(" 减少内核对 "),k,s(" 的使用这一步主要是针对使用机械硬盘的同学，因为在机械硬盘中大量对 "),x,s(" 进行读写会拖慢系统的速度， Debian wiki 里面写的是停止内核使用 "),y,s(" 文件，可能是原作者笔误，也可能是他瞎说的🤗")])]),q])}const B=i(u,[["render",D],["__file","Deepin休眠.html.vue"]]);export{B as default};
